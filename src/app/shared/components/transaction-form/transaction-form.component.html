<div class="transaction-form">
  <form
    [formGroup]="transactionForm"
    (ngSubmit)="onSubmit()"
    class="transaction-form__content"
  >
    <!-- Transaction Type Field -->
    <div class="form-field">
      <label for="transaction-type" class="form-field__label">
        {{ "transactions.form.type" | translate }}
        <span class="required">{{ "transactions.form.required" | translate }}</span>
      </label>
      <p-dropdown
        id="transaction-type"
        formControlName="transactionType"
        [options]="transactionTypeOptions"
        [placeholder]="'transactions.form.typePlaceholder' | translate"
        [showClear]="true"
        [filter]="false"
        [class.p-invalid]="
          transactionForm.get('transactionType')?.invalid && 
          transactionForm.get('transactionType')?.touched
        "
        styleClass="w-full"
      />
      <small
        *ngIf="getFieldError('transactionType')"
        class="p-error"
        style="display: block; margin-top: 0.25rem"
      >
        {{ getFieldError('transactionType') }}
      </small>
    </div>

    <!-- Category Field (for Income/Expense) -->
    <div class="form-field" *ngIf="shouldShowCategoryField()">
      <label for="transaction-category" class="form-field__label">
        {{ "transactions.form.category" | translate }}
        <span class="required">{{ "transactions.form.required" | translate }}</span>
      </label>
      <p-dropdown
        id="transaction-category"
        formControlName="categoryId"
        [options]="categoryOptions"
        [placeholder]="'transactions.form.categoryPlaceholder' | translate"
        [showClear]="true"
        [filter]="true"
        filterBy="label"
        [class.p-invalid]="
          transactionForm.get('categoryId')?.invalid &&
          transactionForm.get('categoryId')?.touched
        "
        styleClass="w-full"
      />
      <small
        *ngIf="getFieldError('categoryId')"
        class="p-error"
        style="display: block; margin-top: 0.25rem"
      >
        {{ getFieldError('categoryId') }}
      </small>
    </div>

    <!-- From Wallet Field (for Transfer/Expense) -->
    <div class="form-field" *ngIf="shouldShowFromWalletField()">
      <label for="wallet-from" class="form-field__label">
        {{ "transactions.form.fromWallet" | translate }}
      </label>
      <p-dropdown
        id="wallet-from"
        formControlName="walletFromId"
        [options]="getWalletOptionsWithNull()"
        [placeholder]="'transactions.form.fromWalletPlaceholder' | translate"
        [showClear]="true"
        [filter]="true"
        filterBy="label"
        [class.p-invalid]="
          transactionForm.get('walletFromId')?.invalid &&
          transactionForm.get('walletFromId')?.touched
        "
        styleClass="w-full"
      />
      <small
        *ngIf="getFieldError('walletFromId')"
        class="p-error"
        style="display: block; margin-top: 0.25rem"
      >
        {{ getFieldError('walletFromId') }}
      </small>
    </div>

    <!-- To Wallet Field (for Transfer/Income) -->
    <div class="form-field" *ngIf="shouldShowToWalletField()">
      <label for="wallet-to" class="form-field__label">
        {{ "transactions.form.toWallet" | translate }}
      </label>
      <p-dropdown
        id="wallet-to"
        formControlName="walletToId"
        [options]="getWalletOptionsWithNull()"
        [placeholder]="'transactions.form.toWalletPlaceholder' | translate"
        [showClear]="true"
        [filter]="true"
        filterBy="label"
        [class.p-invalid]="
          transactionForm.get('walletToId')?.invalid &&
          transactionForm.get('walletToId')?.touched
        "
        styleClass="w-full"
      />
      <small
        *ngIf="getFieldError('walletToId')"
        class="p-error"
        style="display: block; margin-top: 0.25rem"
      >
        {{ getFieldError('walletToId') }}
      </small>
    </div>

    <!-- Amount Field -->
    <div class="form-field">
      <label for="transaction-amount" class="form-field__label">
        {{ "transactions.form.amount" | translate }}
        <span class="required">{{ "transactions.form.required" | translate }}</span>
        <span *ngIf="transactionForm.get('walletFromId')?.value && getWalletCurrency(transactionForm.get('walletFromId')?.value)">
          ({{ getWalletCurrency(transactionForm.get('walletFromId')?.value) }})
        </span>
      </label>
      <p-inputNumber
        id="transaction-amount"
        formControlName="amount"
        [placeholder]="'transactions.form.amountPlaceholder' | translate"
        [min]="0.01"
        [step]="0.01"
        [useGrouping]="true"
        [minFractionDigits]="2"
        [maxFractionDigits]="2"
        [class.p-invalid]="
          transactionForm.get('amount')?.invalid &&
          transactionForm.get('amount')?.touched
        "
        styleClass="w-full"
      />
      <small
        *ngIf="getFieldError('amount')"
        class="p-error"
        style="display: block; margin-top: 0.25rem"
      >
        {{ getFieldError('amount') }}
      </small>
    </div>

    <!-- Exchange Rate Field (for different currencies) -->
    <div class="form-field" *ngIf="shouldShowExchangeRateField()">
      <label for="exchange-rate" class="form-field__label">
        {{ "transactions.form.exchangeRate" | translate }}
        <span class="required">{{ "transactions.form.required" | translate }}</span>
        <span class="exchange-rate-label">
          {{ getWalletCurrency(transactionForm.get('walletFromId')?.value) }} to {{ getWalletCurrency(transactionForm.get('walletToId')?.value) }}
        </span>
      </label>
      <p-inputNumber
        id="exchange-rate"
        formControlName="exchangeRate"
        [placeholder]="'transactions.form.exchangeRatePlaceholder' | translate"
        [min]="0.0001"
        [step]="0.0001"
        [useGrouping]="false"
        [minFractionDigits]="1"
        [maxFractionDigits]="6"
        [class.p-invalid]="
          transactionForm.get('exchangeRate')?.invalid &&
          transactionForm.get('exchangeRate')?.touched
        "
        styleClass="w-full"
      />
      <small
        *ngIf="getFieldError('exchangeRate')"
        class="p-error"
        style="display: block; margin-top: 0.25rem"
      >
        {{ getFieldError('exchangeRate') }}
      </small>
    </div>

    <!-- Amount To Field (for different currencies) -->
    <div class="form-field" *ngIf="shouldShowAmountToField()">
      <label for="transaction-amount-to" class="form-field__label">
        {{ "transactions.form.amountTo" | translate }}
        <span class="required">{{ "transactions.form.required" | translate }}</span>
        <span *ngIf="transactionForm.get('walletToId')?.value && getWalletCurrency(transactionForm.get('walletToId')?.value)">
          ({{ getWalletCurrency(transactionForm.get('walletToId')?.value) }})
        </span>
      </label>
      <p-inputNumber
        id="transaction-amount-to"
        formControlName="amountTo"
        [placeholder]="'transactions.form.amountToPlaceholder' | translate"
        [min]="0.01"
        [step]="0.01"
        [useGrouping]="true"
        [minFractionDigits]="2"
        [maxFractionDigits]="2"
        [readonly]="true"
        [class.p-invalid]="
          transactionForm.get('amountTo')?.invalid &&
          transactionForm.get('amountTo')?.touched
        "
        styleClass="w-full"
      />
      <small
        *ngIf="getFieldError('amountTo')"
        class="p-error"
        style="display: block; margin-top: 0.25rem"
      >
        {{ getFieldError('amountTo') }}
      </small>
    </div>

    <!-- Note Field -->
    <div class="form-field">
      <label for="transaction-note" class="form-field__label">
        {{ "transactions.form.note" | translate }}
      </label>
      <textarea
        id="transaction-note"
        pInputText
        formControlName="note"
        [placeholder]="'transactions.form.notePlaceholder' | translate"
        [maxlength]="500"
        rows="3"
        [class.p-invalid]="
          transactionForm.get('note')?.invalid &&
          transactionForm.get('note')?.touched
        "
        class="w-full"
        style="resize: vertical; min-height: 80px"
      ></textarea>
      <small
        *ngIf="getFieldError('note')"
        class="p-error"
        style="display: block; margin-top: 0.25rem"
      >
        {{ getFieldError('note') }}
      </small>
    </div>

    <!-- Effective Date Field -->
    <div class="form-field">
      <label for="transaction-date" class="form-field__label">
        {{ "transactions.form.effectiveDate" | translate }}
        <span class="required">{{ "transactions.form.required" | translate }}</span>
      </label>
      <p-calendar
        id="transaction-date"
        formControlName="effectiveDate"
        [placeholder]="'transactions.form.effectiveDatePlaceholder' | translate"
        [showIcon]="true"
        [showTime]="false"
        dateFormat="dd/mm/yy"
        [class.p-invalid]="
          transactionForm.get('effectiveDate')?.invalid &&
          transactionForm.get('effectiveDate')?.touched
        "
        styleClass="w-full"
      />
      <small
        *ngIf="getFieldError('effectiveDate')"
        class="p-error"
        style="display: block; margin-top: 0.25rem"
      >
        {{ getFieldError('effectiveDate') }}
      </small>
    </div>

    <!-- Form Actions -->
    <div class="transaction-form__actions">
      <pockito-button
        [type]="PockitoButtonType.CANCEL"
        [size]="PockitoButtonSize.MEDIUM"
        (click)="onCancel()"
        [disabled]="isLoading"
      >
        {{ "transactions.form.actions.cancel" | translate }}
      </pockito-button>

      <pockito-button
        [type]="PockitoButtonType.SUBMIT"
        [size]="PockitoButtonSize.MEDIUM"
        buttonType="submit"
        [loading]="isLoading"
        [disabled]="transactionForm.invalid || isLoading"
      >
        {{
          isEditMode
            ? ("transactions.form.actions.update" | translate)
            : ("transactions.form.actions.create" | translate)
        }}
      </pockito-button>
  </div>
  </form>
</div>
