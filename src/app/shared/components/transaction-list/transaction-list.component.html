<div class="wallets-transactions-content">
  <!-- Empty State -->
  <app-empty-state
    *ngIf="
      !pageableTransactions ||
      !pageableTransactions.content ||
      pageableTransactions.content.length === 0
    "
    icon="fa-solid fa-receipt"
    title="transactions.noTransactions"
    message="transactions.noTransactionsMessage"
  ></app-empty-state>

  <!-- Transactions grouped by date -->
  <div
    class="transactions-list"
    *ngIf="
      pageableTransactions &&
      pageableTransactions.content &&
      pageableTransactions.content.length > 0
    "
  >
    <div class="date-section" *ngFor="let dateKey of getSortedDateKeys()">
      <!-- Date header -->
      <div class="date-header">
        <h3>{{ formatDisplayDate(dateKey) }}</h3>
      </div>

      <!-- Transactions for this date -->
      <div class="transactions-for-date">
        <div
          class="transaction-item"
          *ngFor="let transaction of groupedTransactions[dateKey]"
          (click)="onTransactionClick(transaction)"
        >
          <!-- Transaction icon -->
          <div class="transaction-icon">
            <!-- Use iconUrl if available -->
            <img
              *ngIf="transaction.iconUrl"
              [src]="transaction.iconUrl"
              [alt]="getTransactionDisplayName(transaction)"
              class="type-icon custom-icon"
              [pTooltip]="getTransactionDisplayName(transaction)"
              tooltipPosition="top"
            />
            
            <!-- Fallback to FontAwesome icons -->
            <i
              *ngIf="!transaction.iconUrl && transaction.transactionType === TransactionType.TRANSFER"
              class="fa-solid fa-right-left type-icon transfer"
              [pTooltip]="
                'enums.transactionType.' + TransactionType.TRANSFER | translate
              "
              tooltipPosition="top"
            ></i>

            <i
              *ngIf="!transaction.iconUrl && transaction.transactionType === TransactionType.INCOME"
              class="fa-solid fa-arrow-trend-up type-icon income"
              [pTooltip]="
                'enums.transactionType.' + TransactionType.INCOME | translate
              "
              tooltipPosition="top"
            ></i>

            <i
              *ngIf="!transaction.iconUrl && transaction.transactionType === TransactionType.EXPENSE"
              class="fa-solid fa-arrow-trend-down type-icon expense"
              [pTooltip]="
                'enums.transactionType.' + TransactionType.EXPENSE | translate
              "
              tooltipPosition="top"
            ></i>
          </div>

          <!-- Transaction details -->
          <div class="transaction-details">
            <div class="transaction-info">
              <div class="transaction-wallets">
                <!-- Show category name or "Transfer" -->
                <span class="transaction-category">
                  {{ getTransactionDisplayName(transaction) }}
                </span>

                <!-- Show wallet names based on transaction type -->
                <span class="wallet-names">
                  <ng-container
                    *ngIf="
                      transaction.transactionType === TransactionType.TRANSFER
                    "
                  >
                    <span class="wallet-from">{{
                      transaction.walletFromName || ('common.outOfPockito' | translate)
                    }}</span>
                    <span class="wallet-separator">â†’</span>
                    <span class="wallet-to">{{
                      transaction.walletToName || ('common.outOfPockito' | translate)
                    }}</span>
                  </ng-container>
                  <ng-container
                    *ngIf="
                      transaction.transactionType === TransactionType.EXPENSE
                    "
                  >
                    <span class="wallet-from">{{
                      transaction.walletFromName || ('common.outOfPockito' | translate)
                    }}</span>
                  </ng-container>
                  <ng-container
                    *ngIf="
                      transaction.transactionType === TransactionType.INCOME
                    "
                  >
                    <span class="wallet-from">{{
                      transaction.walletToName || ('common.outOfPockito' | translate)
                    }}</span>
                  </ng-container>
                </span>
              </div>
            </div>

            <div class="transaction-meta">
              <div class="transaction-amount">
                <!-- When walletId is provided (wallet detail view) -->
                <span
                  *ngIf="walletId && transaction.walletFromId === walletId"
                  class="amount-negative"
                >
                  {{
                    transaction.amount * -1
                      | pockitoCurrency : wallet?.currency : "code" : true
                  }}
                </span>
                <span
                  *ngIf="walletId && transaction.walletToId === walletId"
                  class="amount-positive"
                >
                  {{
                    transaction.walletToAmount
                      | pockitoCurrency : wallet?.currency : "code" : true
                  }}
                </span>

                <!-- When no walletId is provided (all transactions view) -->
                <span
                  *ngIf="!walletId && transaction.transactionType === 'INCOME'"
                  class="amount-positive"
                >
                  {{
                    transaction.walletToAmount
                      | pockitoCurrency
                        : transaction.walletToCurrency
                        : "code"
                        : true
                  }}
                </span>
                <span
                  *ngIf="!walletId && transaction.transactionType === 'EXPENSE'"
                  class="amount-negative"
                >
                  {{
                    transaction.amount * -1
                      | pockitoCurrency
                        : transaction.walletFromCurrency
                        : "code"
                        : true
                  }}
                </span>
                <span
                  *ngIf="
                    !walletId && transaction.transactionType === 'TRANSFER'
                  "
                >
                  <span
                    *ngIf="transaction.walletFromId && transaction.walletToId"
                    class="amount-neutral"
                  >
                    {{
                      transaction.amount
                        | pockitoCurrency
                          : transaction.walletFromCurrency
                          : "code"
                          : false
                    }}
                  </span>
                  <span
                    *ngIf="!transaction.walletFromId && transaction.walletToId"
                    class="amount-positive"
                  >
                    {{
                      transaction.walletToAmount
                        | pockitoCurrency
                          : transaction.walletToCurrency
                          : "code"
                          : true
                    }}
                  </span>
                  <span
                    *ngIf="transaction.walletFromId && !transaction.walletToId"
                    class="amount-negative"
                  >
                    {{
                      transaction.amount * -1
                        | pockitoCurrency
                          : transaction.walletFromCurrency
                          : "code"
                          : false
                    }}
                  </span>
                </span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Show More Button -->
  <div class="show-more-container" *ngIf="hasMorePages">
    <button 
      class="show-more-btn"
      (click)="onLoadMore()"
      [disabled]="isLoadingMore"
    >
      <i class="pi pi-chevron-down" *ngIf="!isLoadingMore"></i>
      <i class="pi pi-spin pi-spinner" *ngIf="isLoadingMore"></i>
      <span>{{ isLoadingMore ? ('common.loadingMore' | translate) : ('common.showMore' | translate) }}</span>
    </button>
  </div>

  <!-- Transaction Form Dialog -->
  <app-transaction-form-dialog
    [(visible)]="displayTransactionForm"
    [transactionId]="selectedTransactionId"
    (transactionSaved)="onTransactionSaved($event)"
    (formCancelled)="onTransactionFormCancelled()"
  ></app-transaction-form-dialog>
</div>
