<div class="wallets-transactions-content">
  <!-- Empty State -->
  <app-empty-state
    *ngIf="
      !pageableTransactions ||
      !pageableTransactions.content ||
      pageableTransactions.content.length === 0
    "
    icon="fa-solid fa-receipt"
    title="transactions.noTransactions"
    message="transactions.noTransactionsMessage"
  ></app-empty-state>

  <!-- Transactions grouped by date -->
  <div
    class="transactions-list"
    *ngIf="
      pageableTransactions &&
      pageableTransactions.content &&
      pageableTransactions.content.length > 0
    "
  >
    <div class="date-section" *ngFor="let dateKey of getSortedDateKeys()">
      <!-- Date header -->
      <div class="date-header">
        <h3>{{ formatDisplayDate(dateKey) }}</h3>
      </div>

      <!-- Transactions for this date -->
      <div class="transactions-for-date">
        <div
          class="transaction-item"
          *ngFor="let transaction of groupedTransactions[dateKey]"
        >
          <!-- Transaction icon -->
          <div class="transaction-icon">
            <i
              *ngIf="transaction.transactionType === TransactionType.TRANSFER"
              class="fa-solid fa-right-left type-icon transfer"
              [pTooltip]="
                'enums.transactionType.' + TransactionType.TRANSFER | translate
              "
              tooltipPosition="top"
            ></i>

            <i
              *ngIf="transaction.transactionType === TransactionType.INCOME"
              class="fa-solid fa-arrow-trend-up type-icon income"
              [pTooltip]="
                'enums.transactionType.' + TransactionType.INCOME | translate
              "
              tooltipPosition="top"
            ></i>

            <i
              *ngIf="transaction.transactionType === TransactionType.EXPENSE"
              class="fa-solid fa-arrow-trend-down type-icon expense"
              [pTooltip]="
                'enums.transactionType.' + TransactionType.EXPENSE | translate
              "
              tooltipPosition="top"
            ></i>
          </div>

          <!-- Transaction details -->
          <div class="transaction-details">
            <div class="transaction-info">
              <div class="transaction-wallets">
                <!-- Show category name or "Transfer" -->
                <span class="transaction-category">
                  {{ getTransactionDisplayName(transaction) }}
                </span>

                <!-- Show wallet names based on transaction type -->
                <span class="wallet-names">
                  <ng-container
                    *ngIf="
                      transaction.transactionType === TransactionType.TRANSFER
                    "
                  >
                    <span class="wallet-from">{{
                      transaction.walletFromName
                    }}</span>
                    <span class="wallet-separator">â†’</span>
                    <span class="wallet-to">{{
                      transaction.walletToName
                    }}</span>
                  </ng-container>
                  <ng-container
                    *ngIf="
                      transaction.transactionType === TransactionType.EXPENSE
                    "
                  >
                    <span class="wallet-from">{{
                      transaction.walletFromName
                    }}</span>
                  </ng-container>
                  <ng-container
                    *ngIf="
                      transaction.transactionType === TransactionType.INCOME
                    "
                  >
                    <span class="wallet-from">{{
                      transaction.walletToName
                    }}</span>
                  </ng-container>
                </span>
              </div>
            </div>

            <div class="transaction-meta">
              <div class="transaction-amount">
                <!-- When walletId is provided (wallet detail view) -->
                <span
                  *ngIf="walletId && transaction.walletFromId === walletId"
                  class="amount-negative"
                >
                  {{
                    transaction.amount * -1 | pockitoCurrency : wallet?.currency:'code':true
                  }}
                </span>
                <span
                  *ngIf="walletId && transaction.walletToId === walletId"
                  class="amount-positive"
                >
                  {{
                    transaction.walletToAmount
                      | pockitoCurrency : wallet?.currency:'code':true
                  }}
                </span>
                
                <!-- When no walletId is provided (all transactions view) -->
                <span
                  *ngIf="!walletId && transaction.transactionType === 'INCOME'"
                  class="amount-positive"
                >
                  {{ transaction.walletToAmount | pockitoCurrency:transaction.walletToCurrency:'code':true }}
                </span>
                <span
                  *ngIf="!walletId && transaction.transactionType === 'EXPENSE'"
                  class="amount-negative"
                >
                  {{ transaction.amount | pockitoCurrency:transaction.walletFromCurrency:'code':true }}
                </span>
                <span
                  *ngIf="!walletId && transaction.transactionType === 'TRANSFER'"
                  class="amount-neutral"
                >
                  {{ transaction.amount | pockitoCurrency:transaction.walletFromCurrency:'code':false }}
                </span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Pagination -->
  <div class="pagination-container" *ngIf="totalRecords > pageSize">
    <div class="pagination-info">
      {{ getPaginatorTemplate() }}
    </div>

    <div class="pagination-controls">
      <p-button
        [disabled]="currentPage === 0"
        (onClick)="
          onPageChange({
            first: (currentPage - 1) * pageSize,
            rows: pageSize
          })
        "
        icon="pi pi-chevron-left"
        [text]="true"
        size="small"
      ></p-button>

      <span class="page-info">
        {{ currentPage + 1 }} / {{ Math.ceil(totalRecords / pageSize) }}
      </span>

      <p-button
        [disabled]="currentPage >= Math.ceil(totalRecords / pageSize) - 1"
        (onClick)="
          onPageChange({
            first: (currentPage + 1) * pageSize,
            rows: pageSize
          })
        "
        icon="pi pi-chevron-right"
        [text]="true"
        size="small"
      ></p-button>
    </div>

    <div class="page-size-selector">
      <label>{{ "common.rowsPerPage" | translate }}:</label>
      <select
        [value]="pageSize"
        (change)="onPageSizeChange($event)"
        class="page-size-select"
      >
        <option value="5">5</option>
        <option value="10">10</option>
        <option value="20">20</option>
        <option value="50">50</option>
      </select>
    </div>
  </div>
</div>
