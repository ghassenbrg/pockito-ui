<div class="form-container">
  <!-- Page Header -->
  <app-page-header 
    [config]="headerConfig"
    (buttonClick)="onHeaderButtonClick()"
  ></app-page-header>

  <div class="form-content">
    <form [formGroup]="editCategoryForm" (ngSubmit)="onSubmit()" class="form">
      
      <!-- Basic Information Section -->
      <div class="form-section">
        <h3 class="section-title">
          <i class="pi pi-info-circle"></i>
          {{ 'editCategory.sections.basic_info' | translate }}
        </h3>
        
        <div class="form-row">
          <div class="form-field">
            <label for="name" class="field-label">
              {{ 'editCategory.fields.name' | translate }} <span class="required">*</span>
            </label>
            <input
              id="name"
              type="text"
              pInputText
              formControlName="name"
              [placeholder]="'editCategory.placeholders.enter_category_name' | translate"
              [class.invalid]="isFieldInvalid('name')"
              [readonly]="(isViewMode$ | async) || false"
              class="form-input"
              maxlength="50"
              autocomplete="off"
            />
            <div *ngIf="isFieldInvalid('name')" class="error-message">
              {{ getFieldError('name') }}
            </div>
            <small class="field-hint">{{ 'editCategory.hints.name' | translate }}</small>
          </div>

          <div class="form-field">
            <label for="categoryType" class="field-label">
              {{ 'editCategory.fields.category_type' | translate }} <span class="required">*</span>
            </label>
            <p-dropdown
              id="categoryType"
              formControlName="categoryType"
              [options]="(categoryTypes$ | async) || []"
              optionLabel="label"
              optionValue="value"
              [placeholder]="'editCategory.placeholders.category_type_placeholder' | translate"
              [class.invalid]="isFieldInvalid('categoryType')"
              [disabled]="(isViewMode$ | async) || false"
              [readonly]="(isViewMode$ | async) || false"
              class="form-dropdown"
              [showClear]="false"
              [filter]="false"
              appendTo="body"
              [overlayOptions]="{ autoZIndex: true }"
            ></p-dropdown>
            <div *ngIf="isFieldInvalid('categoryType')" class="error-message">
              {{ getFieldError('categoryType') }}
            </div>
            <small class="field-hint">{{ 'editCategory.hints.category_type' | translate }}</small>
          </div>
        </div>

        <div class="form-row">
          <div class="form-field">
            <label for="parentCategoryId" class="field-label">
              {{ 'editCategory.fields.parent_category' | translate }} <span class="optional">({{ 'editCategory.validation.optional' | translate }})</span>
            </label>
            <p-dropdown
              id="parentCategoryId"
              formControlName="parentCategoryId"
              [options]="(parentCategories$ | async) || []"
              optionLabel="label"
              optionValue="value"
              [placeholder]="'editCategory.placeholders.parent_category_placeholder' | translate"
              [disabled]="(isViewMode$ | async) || false"
              [readonly]="(isViewMode$ | async) || false"
              class="form-dropdown"
              [showClear]="true"
              [filter]="true"
              appendTo="body"
              [overlayOptions]="{ autoZIndex: true }"
            ></p-dropdown>
            <small class="field-hint">{{ 'editCategory.hints.parent_category' | translate }}</small>
          </div>

          <div class="form-field">
            <label for="iconUrl" class="field-label">
              {{ 'editCategory.fields.icon_url' | translate }} <span class="optional">({{ 'editCategory.validation.optional' | translate }})</span>
            </label>
            <div class="icon-input-container">
              <input
                id="iconUrl"
                type="url"
                pInputText
                formControlName="iconUrl"
                [placeholder]="'editCategory.placeholders.icon_url_placeholder' | translate"
                [readonly]="(isViewMode$ | async) || false"
                class="form-input"
                (input)="onIconUrlChange()"
                autocomplete="url"
              />
              <div class="icon-preview" *ngIf="editCategoryForm.get('iconUrl')?.value">
                <img
                  [src]="editCategoryForm.get('iconUrl')?.value"
                  [alt]="'Icon preview'"
                  class="preview-image"
                  (error)="onIconPreviewError($event)"
                  (load)="onIconPreviewLoad()"
                />
                <div class="preview-overlay" *ngIf="!iconPreviewLoaded">
                  <i class="pi pi-spin pi-spinner"></i>
                </div>
              </div>
            </div>
            <small class="field-hint">{{ 'editCategory.hints.icon_url' | translate }}</small>
            <div *ngIf="iconPreviewError" class="warning-message">
              {{ 'editCategory.messages.icon_preview_error' | translate }}
            </div>
          </div>
        </div>
      </div>

      <!-- Appearance Section -->
      <div class="form-section">
        <h3 class="section-title">
          <i class="pi pi-palette"></i>
          {{ 'editCategory.sections.appearance' | translate }}
        </h3>
        
        <div class="form-row">
          <div class="form-field">
            <label for="color" class="field-label">
              {{ 'editCategory.fields.color' | translate }} <span class="required">*</span>
            </label>
            <div class="color-picker-container">
              <input
                id="color"
                type="color"
                formControlName="color"
                class="form-color-picker"
                [value]="editCategoryForm.get('color')?.value || '#3b82f6'"
                [disabled]="(isViewMode$ | async) || false"
                (input)="onColorChange($event)"
              />
              <input
                type="text"
                class="form-hex-input"
                [placeholder]="'editCategory.placeholders.hex_color' | translate"
                [value]="editCategoryForm.get('color')?.value || '#3b82f6'"
                [disabled]="(isViewMode$ | async) || false"
                (input)="onHexInputChange($event)"
                maxlength="7"
                pattern="^#[0-9A-Fa-f]{6}$"
              />
            </div>
            <small class="field-hint">{{ 'editCategory.hints.color' | translate }}</small>
          </div>
        </div>
      </div>


      <!-- Form Actions -->
      <div class="form-actions" *ngIf="!(isViewMode$ | async)">
        <div class="form-actions-left">
          <button
            type="button"
            pButton
            [label]="'editCategory.buttons.cancel' | translate"
            icon="pi pi-times"
            class="p-button-outlined"
            (click)="onCancel()"
            [disabled]="(isUpdatingCategory$ | async) || (isCreatingCategory$ | async)"
          ></button>
        </div>
        
        <div class="form-actions-right">
          <button
            type="submit"
            pButton
            [label]="(isEditMode$ | async) ? ('editCategory.buttons.update' | translate) : ('editCategory.buttons.create' | translate)"
            [icon]="(isEditMode$ | async) ? 'pi pi-check' : 'pi pi-plus'"
            class="p-button-primary"
            [loading]="((isUpdatingCategory$ | async) || false) || ((isCreatingCategory$ | async) || false)"
            [disabled]="editCategoryForm.invalid || (isUpdatingCategory$ | async) || (isCreatingCategory$ | async)"
          ></button>
        </div>
      </div>

      <!-- View Mode Actions -->
      <div class="form-actions" *ngIf="isViewMode$ | async">
        <div class="form-actions-left">
          <button
            type="button"
            pButton
            [label]="'editCategory.buttons.back' | translate"
            icon="pi pi-arrow-left"
            class="p-button-outlined"
            (click)="onCancel()"
          ></button>
        </div>
        
        <div class="form-actions-right">
          <button
            type="button"
            pButton
            [label]="'editCategory.buttons.edit' | translate"
            icon="pi pi-pencil"
            class="p-button-primary"
            (click)="onEditClick()"
          ></button>
        </div>
      </div>
    </form>
  </div>
</div>