<div class="wallets-container" *ngIf="wallet">
  <app-page-header>
    <div class="wallet-info" slot="title">
      <img [src]="wallet.iconUrl || 'assets/icons/' + wallet.type + '.png'" alt="{{ wallet.name }} icon" />
      <h1 class="wallet-name">
        {{ wallet.name }}
      </h1>
      <h1
        class="wallet-balance"
        [class.positive]="wallet.balance && wallet.balance > 0"
        [class.negative]="wallet.balance && wallet.balance < 0"
        [class.zero]="!wallet.balance || wallet.balance === 0"
      >
        ({{ wallet.balance | pockitoCurrency : wallet.currency }})
      </h1>
    </div>

    <div slot="actions">
      <p-menu #menu [model]="menuItems" [popup]="true" appendTo="body" />
      <p-button (onClick)="menu.toggle($event)" icon="pi pi-ellipsis-v" />
    </div>
  </app-page-header>

  <div class="wallets-content">
    <div class="wallets-transactions"></div>
    <div class="wallets-transactions-header">
      <h2>{{ "wallets.transactions" | translate }}</h2>
    </div>
    <div class="wallets-transactions-content" *ngIf="pageableTransactions">
      <!-- Transactions grouped by date -->
      <div class="transactions-list">
        <div class="date-section" *ngFor="let dateKey of getSortedDateKeys()">
          <!-- Date header -->
          <div class="date-header">
            <h3>{{ formatDisplayDate(dateKey) }}</h3>
          </div>

          <!-- Transactions for this date -->
          <div class="transactions-for-date">
            <div
              class="transaction-item"
              *ngFor="let transaction of groupedTransactions[dateKey]"
            >
              <!-- Transaction icon -->
              <div class="transaction-icon">
                <i
                  *ngIf="
                    transaction.transactionType === TransactionType.TRANSFER
                  "
                  class="fa-solid fa-right-left type-icon transfer"
                  [pTooltip]="
                    'enums.transactionType.' + TransactionType.TRANSFER
                      | translate
                  "
                  tooltipPosition="top"
                ></i>

                <i
                  *ngIf="transaction.transactionType === TransactionType.INCOME"
                  class="fa-solid fa-arrow-trend-up type-icon income"
                  [pTooltip]="
                    'enums.transactionType.' + TransactionType.INCOME
                      | translate
                  "
                  tooltipPosition="top"
                ></i>

                <i
                  *ngIf="
                    transaction.transactionType === TransactionType.EXPENSE
                  "
                  class="fa-solid fa-arrow-trend-down type-icon expense"
                  [pTooltip]="
                    'enums.transactionType.' + TransactionType.EXPENSE
                      | translate
                  "
                  tooltipPosition="top"
                ></i>
              </div>

              <!-- Transaction details -->
              <div class="transaction-details">
                <div class="transaction-info">
                  <div class="transaction-wallets">
                    <!-- Show category name or "Transfer" -->
                    <span class="transaction-category">
                      {{ getTransactionDisplayName(transaction) }}
                    </span>

                    <!-- Show wallet names based on transaction type -->
                    <span class="wallet-names">
                      <ng-container
                        *ngIf="
                          transaction.transactionType ===
                          TransactionType.TRANSFER
                        "
                      >
                        <span class="wallet-from">{{
                          transaction.walletFromName
                        }}</span>
                        <span class="wallet-separator">â†’</span>
                        <span class="wallet-to">{{
                          transaction.walletToName
                        }}</span>
                      </ng-container>
                      <ng-container
                        *ngIf="
                          transaction.transactionType ===
                          TransactionType.EXPENSE
                        "
                      >
                        <span class="wallet-from">{{
                          transaction.walletFromName
                        }}</span>
                      </ng-container>
                      <ng-container
                        *ngIf="
                          transaction.transactionType === TransactionType.INCOME
                        "
                      >
                        <span class="wallet-from">{{
                          transaction.walletToName
                        }}</span>
                      </ng-container>
                    </span>
                  </div>
                </div>

                <div class="transaction-meta">
                  <div class="transaction-amount">
                    <span
                      *ngIf="transaction.walletFromId === walletId"
                      class="amount-negative"
                    >
                      {{
                        transaction.amount * -1
                          | pockitoCurrency : wallet.currency
                      }}
                    </span>
                    <span
                      *ngIf="transaction.walletToId === walletId"
                      class="amount-positive"
                    >
                      {{
                        transaction.walletToAmount
                          | pockitoCurrency : wallet.currency
                      }}
                    </span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Pagination -->
      <div class="pagination-container" *ngIf="totalRecords > pageSize">
        <div class="pagination-info">
          {{ getPaginatorTemplate() }}
        </div>

        <div class="pagination-controls">
          <p-button
            [disabled]="currentPage === 0"
            (onClick)="
              onPageChange({
                first: (currentPage - 1) * pageSize,
                rows: pageSize
              })
            "
            icon="pi pi-chevron-left"
            [text]="true"
            size="small"
          ></p-button>

          <span class="page-info">
            {{ currentPage + 1 }} / {{ Math.ceil(totalRecords / pageSize) }}
          </span>

          <p-button
            [disabled]="currentPage >= Math.ceil(totalRecords / pageSize) - 1"
            (onClick)="
              onPageChange({
                first: (currentPage + 1) * pageSize,
                rows: pageSize
              })
            "
            icon="pi pi-chevron-right"
            [text]="true"
            size="small"
          ></p-button>
        </div>

        <div class="page-size-selector">
          <label>{{ "common.rowsPerPage" | translate }}:</label>
          <select
            [value]="pageSize"
            (change)="onPageSizeChange($event)"
            class="page-size-select"
          >
            <option value="5">5</option>
            <option value="10">10</option>
            <option value="20">20</option>
            <option value="50">50</option>
          </select>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Wallet Form Dialog -->
<p-dialog
  [maximizable]="true"
  [(visible)]="displayEditWalletDialog"
  [breakpoints]="{ '960px': '90vw', '640px': '100vw' }"
  [style]="{ width: '60vw' }"
  [modal]="true"
  [header]="'wallets.createWallet' | translate"
  [closable]="true"
  [closeOnEscape]="true"
>
  <app-wallet-form
    *ngIf="displayEditWalletDialog"
    (walletSaved)="onWalletSaved($event)"
    (formCancelled)="onFormCancelled()"
    [walletId]="wallet?.id"
  ></app-wallet-form>
</p-dialog>
