<div class="wallet-form">
  <form
    [formGroup]="walletForm"
    (ngSubmit)="onSubmit()"
    class="wallet-form__content"
  >
    <!-- Name Field -->
    <div class="form-field">
      <label for="wallet-name" class="form-field__label">
        {{ "wallets.form.name" | translate }}
        <span class="required">{{ "wallets.form.required" | translate }}</span>
      </label>
      <input
        id="wallet-name"
        type="text"
        pInputText
        formControlName="name"
        [placeholder]="'wallets.form.namePlaceholder' | translate"
        [maxlength]="100"
        [class.p-invalid]="
          walletForm.get('name')?.invalid && walletForm.get('name')?.touched
        "
        class="w-full"
      />
      <small
        *ngIf="getFieldError('name')"
        class="p-error"
        style="display: block; margin-top: 0.25rem"
      >
        {{ getFieldError("name") }}
      </small>
    </div>

    <!-- Currency Field -->
    <div class="form-field">
      <label for="wallet-currency" class="form-field__label">
        {{ "wallets.form.currency" | translate }}
        <span class="required">{{ "wallets.form.required" | translate }}</span>
      </label>
      <app-pockito-selector
        [selectedId]="walletForm.get('currency')?.value"
        [selectedItem]="getSelectedCurrency(walletForm.get('currency')?.value)"
        [options]="currencyDialogOptions"
        [isInvalid]="(walletForm.get('currency')?.invalid && walletForm.get('currency')?.touched) || false"
        [placeholder]="'wallets.form.currencyPlaceholder'"
        [title]="'wallets.form.selectCurrency'"
        [searchPlaceholder]="'wallets.form.searchCurrencies'"
        [showBalance]="false"
        (itemSelected)="onCurrencySelected($event)"
        (itemCleared)="onCurrencyCleared()"
        (itemTouched)="onCurrencyTouched()"
      ></app-pockito-selector>
      <small
        *ngIf="getFieldError('currency')"
        class="p-error"
        style="display: block; margin-top: 0.25rem"
      >
        {{ getFieldError("currency") }}
      </small>
    </div>

    <!-- Type Field -->
    <div class="form-field">
      <label for="wallet-type" class="form-field__label">
        {{ "wallets.form.type" | translate }}
        <span class="required">{{ "wallets.form.required" | translate }}</span>
      </label>
      <app-pockito-selector
        [selectedId]="walletForm.get('type')?.value"
        [selectedItem]="getSelectedWalletType(walletForm.get('type')?.value)"
        [options]="walletTypeDialogOptions"
        [isInvalid]="(walletForm.get('type')?.invalid && walletForm.get('type')?.touched) || false"
        [placeholder]="'wallets.form.typePlaceholder'"
        [title]="'wallets.form.selectType'"
        [searchPlaceholder]="'wallets.form.searchTypes'"
        [showBalance]="false"
        (itemSelected)="onWalletTypeSelected($event)"
        (itemCleared)="onWalletTypeCleared()"
        (itemTouched)="onWalletTypeTouched()"
      ></app-pockito-selector>
      <small
        *ngIf="getFieldError('type')"
        class="p-error"
        style="display: block; margin-top: 0.25rem"
      >
        {{ getFieldError("type") }}
      </small>
    </div>

    <!-- Initial Balance Field -->
    <div class="form-field">
      <label for="wallet-balance" class="form-field__label">
        {{ "wallets.form.initialBalance" | translate }}
      </label>
      <p-inputNumber
        id="wallet-balance"
        formControlName="initialBalance"
        [placeholder]="'wallets.form.initialBalancePlaceholder' | translate"
        [min]="0"
        [step]="0.01"
        [useGrouping]="true"
        inputMode="decimal"
        [class.p-invalid]="
          walletForm.get('initialBalance')?.invalid &&
          walletForm.get('initialBalance')?.touched
        "
        styleClass="w-full"
      />
      <small
        *ngIf="getFieldError('initialBalance')"
        class="p-error"
        style="display: block; margin-top: 0.25rem"
      >
        {{ getFieldError("initialBalance") }}
      </small>
    </div>

    <!-- Description Field -->
    <div class="form-field">
      <label for="wallet-description" class="form-field__label">
        {{ "wallets.form.description" | translate }}
      </label>
      <textarea
        id="wallet-description"
        pInputText
        formControlName="description"
        [placeholder]="'wallets.form.descriptionPlaceholder' | translate"
        [maxlength]="500"
        rows="3"
        [class.p-invalid]="
          walletForm.get('description')?.invalid &&
          walletForm.get('description')?.touched
        "
        class="w-full"
        style="resize: vertical; min-height: 100px"
      ></textarea>
      <small
        *ngIf="getFieldError('description')"
        class="p-error"
        style="display: block; margin-top: 0.25rem"
      >
        {{ getFieldError("description") }}
      </small>
    </div>

    <!-- Icon URL Field -->
    <div class="form-field">
      <label for="wallet-icon" class="form-field__label">
        {{ "wallets.form.icon" | translate }}
      </label>
      <input
        id="wallet-icon"
        type="url"
        pInputText
        formControlName="iconUrl"
        [placeholder]="'wallets.form.iconPlaceholder' | translate"
        [class.p-invalid]="
          walletForm.get('iconUrl')?.invalid &&
          walletForm.get('iconUrl')?.touched
        "
        class="w-full"
      />
      <small
        *ngIf="getFieldError('iconUrl')"
        class="p-error"
        style="display: block; margin-top: 0.25rem"
      >
        {{ getFieldError("iconUrl") }}
      </small>

      <!-- Icon Preview -->
      <div
        class="icon-preview"
        *ngIf="getIconUrl() && isValidImageUrl(getIconUrl())"
      >
        <div class="icon-preview__container">
          <img
            [src]="getIconUrl()"
            [alt]="'wallets.form.iconPreview' | translate"
            class="icon-preview__image"
            (error)="onImageError($event)"
            onerror="this.src='/assets/images/placeholder.png'"
          />
          <div class="icon-preview__label">
            {{ "wallets.form.iconPreview" | translate }}
          </div>
        </div>
      </div>
    </div>

    <!-- Color Field -->
    <div class="form-field">
      <label for="wallet-color" class="form-field__label">
        {{ "wallets.form.color" | translate }}
      </label>
      <div class="color-picker">
        <p-colorPicker
          id="wallet-color"
          formControlName="color"
          [inline]="false"
          [format]="'hex'"
          styleClass="w-full"
        />
        <span class="color-picker__label">{{
          "wallets.form.colorLabel" | translate
        }}</span>
      </div>
    </div>

    <!-- Default Wallet Checkbox -->
    <div class="form-field form-field--checkbox">
      <p-checkbox
        formControlName="isDefault"
        [binary]="true"
        [label]="'wallets.form.isDefault' | translate"
        styleClass="w-full"
      />
    </div>

    <!-- Form Actions -->
    <div class="wallet-form__actions">
      <pockito-button
        [type]="PockitoButtonType.CANCEL"
        [size]="PockitoButtonSize.MEDIUM"
        (click)="onCancel()"
        [disabled]="isLoading"
        class="cancel-button"
      >
        {{ "wallets.form.actions.cancel" | translate }}
      </pockito-button>

      <pockito-button
        [type]="PockitoButtonType.SUBMIT"
        [size]="PockitoButtonSize.MEDIUM"
        buttonType="submit"
        [loading]="isLoading"
        [disabled]="walletForm.invalid || isLoading"
      >
        {{
          isEditMode
            ? ("wallets.form.actions.update" | translate)
            : ("wallets.form.actions.create" | translate)
        }}
      </pockito-button>
    </div>
  </form>
</div>
