<p-dialog 
  [visible]="visible" 
  [modal]="true" 
  [closable]="false"
  [draggable]="false"
  [resizable]="false"
  [style]="{ width: '90vw', maxWidth: '600px' }"
  [breakpoints]="{ '960px': '95vw', '640px': '100vw' }"
  (onHide)="onCancel()"
  (onShow)="onShow()"
  [dismissableMask]="true"
  class="transaction-modal">
  
  <ng-template pTemplate="header">
    <div class="modal-header">
      <h3 class="modal-title">{{ modalTitle | translate }}</h3>
      <button 
        type="button" 
        class="p-dialog-header-icon p-dialog-header-close p-link" 
        (click)="onCancel()"
        [attr.aria-label]="'common.close' | translate">
        <span class="p-dialog-header-close-icon pi pi-times"></span>
      </button>
    </div>
  </ng-template>
  
  <form [formGroup]="transactionForm" (ngSubmit)="onSubmit()" class="transaction-form">
    <div class="form-section">
      <h3>{{ 'transaction.create.basic_info' | translate }}</h3>
      
      <div class="form-row">
        <div class="form-group">
          <label for="transactionType">{{ 'transaction.create.type' | translate }} *</label>
          <p-dropdown 
            id="transactionType"
            formControlName="transactionType"
            [options]="transactionTypes"
            optionLabel="label"
            optionValue="value"
            [placeholder]="'transaction.create.select_type' | translate"
            [disabled]="isFormDisabled"
            class="form-control">
          </p-dropdown>
          <small class="error-message" *ngIf="getFieldError('transactionType')">
            {{ getFieldError('transactionType') }}
          </small>
        </div>

        <div class="form-group">
          <label for="amount">{{ 'transaction.create.amount' | translate }} *</label>
          <p-inputNumber 
            id="amount"
            formControlName="amount"
            mode="currency"
            currency="USD"
            [min]="0.01"
            [step]="0.01"
            [placeholder]="'transaction.create.enter_amount' | translate"
            [disabled]="isFormDisabled"
            class="form-control">
          </p-inputNumber>
          <small class="error-message" *ngIf="getFieldError('amount')">
            {{ getFieldError('amount') }}
          </small>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group" *ngIf="transactionForm.get('transactionType')?.value === 'EXPENSE' || transactionForm.get('transactionType')?.value === 'TRANSFER'">
          <label for="walletFromId">{{ 'transaction.create.from_wallet' | translate }} *</label>
          <p-dropdown 
            id="walletFromId"
            formControlName="walletFromId"
            [options]="wallets"
            optionLabel="name"
            optionValue="id"
            [placeholder]="'transaction.create.select_from_wallet' | translate"
            [disabled]="isFormDisabled"
            class="form-control">
          </p-dropdown>
          <small class="error-message" *ngIf="getFieldError('walletFromId')">
            {{ getFieldError('walletFromId') }}
          </small>
        </div>

        <div class="form-group" *ngIf="transactionForm.get('transactionType')?.value === 'INCOME' || transactionForm.get('transactionType')?.value === 'TRANSFER'">
          <label for="walletToId">{{ 'transaction.create.to_wallet' | translate }} *</label>
          <p-dropdown 
            id="walletToId"
            formControlName="walletToId"
            [options]="wallets"
            optionLabel="name"
            optionValue="id"
            [placeholder]="'transaction.create.select_to_wallet' | translate"
            [disabled]="isFormDisabled"
            class="form-control">
          </p-dropdown>
          <small class="error-message" *ngIf="getFieldError('walletToId')">
            {{ getFieldError('walletToId') }}
          </small>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="effectiveDate">{{ 'transaction.create.date' | translate }} *</label>
          <p-calendar 
            id="effectiveDate"
            formControlName="effectiveDate"
            [placeholder]="'transaction.create.select_date' | translate"
            [disabled]="isFormDisabled"
            class="form-control">
          </p-calendar>
          <small class="error-message" *ngIf="getFieldError('effectiveDate')">
            {{ getFieldError('effectiveDate') }}
          </small>
        </div>

        <div class="form-group">
          <label for="categoryId">{{ 'transaction.create.category' | translate }}</label>
          <p-dropdown 
            id="categoryId"
            formControlName="categoryId"
            [options]="categories"
            optionLabel="name"
            optionValue="id"
            [placeholder]="'transaction.create.select_category' | translate"
            [showClear]="true"
            [disabled]="isFormDisabled"
            class="form-control">
          </p-dropdown>
        </div>
      </div>

      <div class="form-row" *ngIf="transactionForm.get('transactionType')?.value === 'TRANSFER'">
        <div class="form-group">
          <label for="exchangeRate">{{ 'transaction.create.exchange_rate' | translate }}</label>
          <p-inputNumber 
            id="exchangeRate"
            formControlName="exchangeRate"
            [min]="0.000001"
            [step]="0.000001"
            [placeholder]="'transaction.create.enter_exchange_rate' | translate"
            [disabled]="isFormDisabled"
            class="form-control">
          </p-inputNumber>
          <small class="error-message" *ngIf="getFieldError('exchangeRate')">
            {{ getFieldError('exchangeRate') }}
          </small>
        </div>
      </div>

      <div class="form-group">
        <label for="note">{{ 'transaction.create.note' | translate }}</label>
        <textarea 
          id="note"
          formControlName="note"
          pInputTextarea
          [placeholder]="'transaction.create.enter_note' | translate"
          [disabled]="isFormDisabled"
          rows="3"
          class="form-control">
        </textarea>
      </div>
    </div>
  </form>

  <ng-template pTemplate="footer">
    <div class="modal-actions">
      <button 
        type="button" 
        pButton 
        [label]="'common.cancel' | translate"
        (click)="onCancel()"
        [disabled]="loading"
        class="p-button-secondary">
      </button>
      <button 
        type="button" 
        pButton 
        [label]="submitButtonLabel | translate"
        [loading]="loading"
        [disabled]="transactionForm.invalid && mode !== 'view'"
        (click)="onSubmit()"
        class="p-button-primary">
      </button>
    </div>
  </ng-template>
</p-dialog>
